<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>App Bundle Size Analysis</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f7;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #chart {
      width: 900px;
      height: 700px;
      margin: auto;
    }
    h1 {
      color: #1d1d1f;
      margin-top: 0;
      margin-bottom: 20px;
      text-align: center;
    }
    .info-banner {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      background: #f8f8fa;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .info-item {
      display: flex;
      flex-direction: column;
    }
    .info-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .info-value {
      font-size: 16px;
      color: #1d1d1f;
      font-weight: 500;
    }
    .size-info {
      color: #0066cc;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>App Bundle Size Analysis</h1>
  <div class="info-banner">
    <div class="info-item">
      <span class="info-label">Name</span>
      <span class="info-value" id="appName">HexaCalc</span>
    </div>
    <div class="info-item">
      <span class="info-label">Bundle ID</span>
      <span class="info-value" id="bundleId">-</span>
    </div>
    <div class="info-item">
      <span class="info-label">Platform</span>
      <span class="info-value" id="platform">iOS</span>
    </div>
    <div class="info-item">
      <span class="info-label">Version</span>
      <span class="info-value" id="version">-</span>
    </div>
    <div class="info-item">
      <span class="info-label">Download Size</span>
      <span class="info-value size-info" id="downloadSize">-</span>
    </div>
    <div class="info-item">
      <span class="info-label">Install Size</span>
      <span class="info-value size-info" id="installSize">-</span>
    </div>
  </div>
  <div id="chart"></div>
</div>
<script>
const fileTree = {
    "relative_path": ".",
    "size": 733280,
    "shasum": "ea685de7c45ac70ddb8419382de5bcac697ce4abb0ace0cbbb617257c3f5b849",
    "type": "directory",
    "children": [
      {
        "relative_path": "AppIcon60x60@2x.png",
        "size": 4441,
        "shasum": "9a541149057be7740b2c1e86a4d212c1c9fb5aee4bbfd348f019d6fe2b9ee131",
        "type": "binary"
      },
      {
        "relative_path": "AppIcon76x76@2x~ipad.png",
        "size": 5604,
        "shasum": "9ace38f6d44ee608d0532f836a157c5123de4e7c52d16f5fd75a82f725c93201",
        "type": "binary"
      },
      {
        "relative_path": "Assets.car",
        "size": 130399,
        "shasum": "067921892f2b3a30f79024a6b02d6c9ccbccc62f2e800f18cd2bcb4ec780a543",
        "type": "asset_catalog"
      },
      {
        "relative_path": "Base.lproj",
        "size": 97792,
        "shasum": "e394197cf388b1cb56ca98623bb43a6fd072acd8b94571c700151e81dda3111d",
        "type": "directory",
        "children": [
          {
            "relative_path": "Base.lproj/LaunchScreen.storyboardc",
            "size": 2889,
            "shasum": "6c3458aec127737f7a5edbf7a37a48af41636260ece03c5229c4ffba13e70fd4",
            "type": "directory",
            "children": [
              {
                "relative_path": "Base.lproj/LaunchScreen.storyboardc/01J-lp-oVM-view-Ze5-6b-2t3.nib",
                "size": 1707,
                "shasum": "830e8aff1d3b034c8fc6eab39092e733e666fd98d953a2ae0f6e8809c760f38b",
                "type": "binary"
              },
              {
                "relative_path": "Base.lproj/LaunchScreen.storyboardc/Info.plist",
                "size": 258,
                "shasum": "1f255d5cc53b531e3f29a9406a8df49a958e2bf9443d3e20bd8374f707f7d5c8",
                "type": "binary"
              },
              {
                "relative_path": "Base.lproj/LaunchScreen.storyboardc/UIViewController-01J-lp-oVM.nib",
                "size": 924,
                "shasum": "54f3637f671feba5f19e82ec4f4a7fb448bb3cfc0fb180f089aa571fc8f053e2",
                "type": "binary"
              }
            ]
          },
          {
            "relative_path": "Base.lproj/Main.storyboardc",
            "size": 94903,
            "shasum": "f5cf264970920b7e10e6d37ec8ce1f5a4c5c44176690b10bdc3a964a0523f167",
            "type": "directory",
            "children": [
              {
                "relative_path": "Base.lproj/Main.storyboardc/8rJ-Kc-sve-view-QS5-Rx-YEW.nib",
                "size": 25526,
                "shasum": "f34c43a5feffe41d733046efbc214303a2b9fa1f6529eff6dc4d170f970b78fd",
                "type": "directory",
                "children": [
                  {
                    "relative_path": "Base.lproj/Main.storyboardc/8rJ-Kc-sve-view-QS5-Rx-YEW.nib/objects-14.0+.nib",
                    "size": 12763,
                    "shasum": "0723730b1a2bf541b7c7f86bcee32676a800d93ab9f460f4235b92f17cca7eb5",
                    "type": "binary"
                  },
                  {
                    "relative_path": "Base.lproj/Main.storyboardc/8rJ-Kc-sve-view-QS5-Rx-YEW.nib/runtime.nib",
                    "size": 12763,
                    "shasum": "0723730b1a2bf541b7c7f86bcee32676a800d93ab9f460f4235b92f17cca7eb5",
                    "type": "binary"
                  }
                ]
              },
              {
                "relative_path": "Base.lproj/Main.storyboardc/9pv-A4-QxB-view-tsR-hK-woN.nib",
                "size": 31766,
                "shasum": "4d1aa284c35022053056dcfe19d4a88c59045b1844c892bcaeabd386ea696415",
                "type": "directory",
                "children": [
                  {
                    "relative_path": "Base.lproj/Main.storyboardc/9pv-A4-QxB-view-tsR-hK-woN.nib/objects-14.0+.nib",
                    "size": 15883,
                    "shasum": "305e8225d8c24e55c6154474fd4d04fb09caab6cfc24bf0a338d08e3b4c133b6",
                    "type": "binary"
                  },
                  {
                    "relative_path": "Base.lproj/Main.storyboardc/9pv-A4-QxB-view-tsR-hK-woN.nib/runtime.nib",
                    "size": 15883,
                    "shasum": "305e8225d8c24e55c6154474fd4d04fb09caab6cfc24bf0a338d08e3b4c133b6",
                    "type": "binary"
                  }
                ]
              },
              {
                "relative_path": "Base.lproj/Main.storyboardc/CNG-kH-WYO-view-LJl-eX-gQn.nib",
                "size": 2450,
                "shasum": "c73b92f81a19ca52cb03b3ae4701c8dfd6dc350643f722bef008ce76e8b0d8e6",
                "type": "directory",
                "children": [
                  {
                    "relative_path": "Base.lproj/Main.storyboardc/CNG-kH-WYO-view-LJl-eX-gQn.nib/objects-14.0+.nib",
                    "size": 1225,
                    "shasum": "5cd7eefc1eecc445972294109064ef3853e41f49c1925ec6d4db1b26e8771197",
                    "type": "binary"
                  },
                  {
                    "relative_path": "Base.lproj/Main.storyboardc/CNG-kH-WYO-view-LJl-eX-gQn.nib/runtime.nib",
                    "size": 1225,
                    "shasum": "5cd7eefc1eecc445972294109064ef3853e41f49c1925ec6d4db1b26e8771197",
                    "type": "binary"
                  }
                ]
              },
              {
                "relative_path": "Base.lproj/Main.storyboardc/G05-w2-BtH-view-9Vu-NR-tEg.nib",
                "size": 24868,
                "shasum": "e1df7ec510bdc0030422b43fe31907c34e122daf8521547948ca4d7ecf373f93",
                "type": "directory",
                "children": [
                  {
                    "relative_path": "Base.lproj/Main.storyboardc/G05-w2-BtH-view-9Vu-NR-tEg.nib/objects-14.0+.nib",
                    "size": 12434,
                    "shasum": "0c1fdf3d63fd1d001a7653fe714ed81ddd12ce55a10f4c7a25b550d529130807",
                    "type": "binary"
                  },
                  {
                    "relative_path": "Base.lproj/Main.storyboardc/G05-w2-BtH-view-9Vu-NR-tEg.nib/runtime.nib",
                    "size": 12434,
                    "shasum": "0c1fdf3d63fd1d001a7653fe714ed81ddd12ce55a10f4c7a25b550d529130807",
                    "type": "binary"
                  }
                ]
              },
              {
                "relative_path": "Base.lproj/Main.storyboardc/Info.plist",
                "size": 253,
                "shasum": "262b3f5796cad5efaa0a37d8e559f09dd2df587559cdfd02316990a58e562336",
                "type": "binary"
              },
              {
                "relative_path": "Base.lproj/Main.storyboardc/SettingsSelectionVC.nib",
                "size": 2210,
                "shasum": "7643aacff05fb577bd536c6f0690b5396b67a7825ed845b6c069ad944d45e335",
                "type": "directory",
                "children": [
                  {
                    "relative_path": "Base.lproj/Main.storyboardc/SettingsSelectionVC.nib/objects-14.0+.nib",
                    "size": 1105,
                    "shasum": "1c48e8ab2acbaa3d4ce6f95d6013d1c00f0cbac8751648c942e9c83bbc7989d3",
                    "type": "binary"
                  },
                  {
                    "relative_path": "Base.lproj/Main.storyboardc/SettingsSelectionVC.nib/runtime.nib",
                    "size": 1105,
                    "shasum": "1c48e8ab2acbaa3d4ce6f95d6013d1c00f0cbac8751648c942e9c83bbc7989d3",
                    "type": "binary"
                  }
                ]
              },
              {
                "relative_path": "Base.lproj/Main.storyboardc/tabBarController.nib",
                "size": 7830,
                "shasum": "a63c2871111069b1d7dbf362c66fea5d638cb45c540dc0224b86df3acf5232f6",
                "type": "directory",
                "children": [
                  {
                    "relative_path": "Base.lproj/Main.storyboardc/tabBarController.nib/objects-14.0+.nib",
                    "size": 3194,
                    "shasum": "bf9399e28efdd8f17bdc806d188ebcc53f1377d4f867ff251275d9937552e8fa",
                    "type": "binary"
                  },
                  {
                    "relative_path": "Base.lproj/Main.storyboardc/tabBarController.nib/runtime.nib",
                    "size": 4636,
                    "shasum": "ca8587c8b9f469cf99218a8f3d41b891384458887185c991d7c722df231a832a",
                    "type": "binary"
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "relative_path": "HexaCalc",
        "size": 419136,
        "shasum": "746d3b91dc5fe7d6bf37cddfef8f389354643e7ed264923664426f0290b04e89",
        "type": "binary"
      },
      {
        "relative_path": "HexaCalc.momd",
        "size": 1518,
        "shasum": "6575a10328c24fa34f0e9731258403979d753ade25ddee116dad6829ac6bdd5b",
        "type": "directory",
        "children": [
          {
            "relative_path": "HexaCalc.momd/HexaCalc.mom",
            "size": 566,
            "shasum": "9cac4edbcc37cac0d3f74fec3332d2ccdab4c290e1b0b51c890fc1445a41313e",
            "type": "binary"
          },
          {
            "relative_path": "HexaCalc.momd/HexaCalc.omo",
            "size": 704,
            "shasum": "1770e5fae75f1fc2218e8d1a0f508c9acf255504d480aba15830d3211d8715be",
            "type": "binary"
          },
          {
            "relative_path": "HexaCalc.momd/VersionInfo.plist",
            "size": 248,
            "shasum": "e704074948eeec6b450ce2d6a8a4d4cc29883bbf0dd5ae90b9ad019bcbc8cc6a",
            "type": "binary"
          }
        ]
      },
      {
        "relative_path": "Info.plist",
        "size": 1890,
        "shasum": "59d30b64716aedd6a960a61b38d48426dc5ccc40db9cfa96d2beb3a00165dc6e",
        "type": "binary"
      },
      {
        "relative_path": "PkgInfo",
        "size": 8,
        "shasum": "82502191c9484b04d685374f9879a0066069c49b8acae7a04b01d38d07e8eca0",
        "type": "binary"
      },
      {
        "relative_path": "SwitchTableViewCell.nib",
        "size": 2450,
        "shasum": "ce1bdbc7620d568f7ac0867a4914bbb45e31bf854a91bc6512d2e17095b56833",
        "type": "binary"
      },
      {
        "relative_path": "_CodeSignature",
        "size": 9027,
        "shasum": "4136f4900b06466e9f03f20180b9e4f27b74e9cd45190196c7f6fcd809fadb13",
        "type": "directory",
        "children": [
          {
            "relative_path": "_CodeSignature/CodeResources",
            "size": 9027,
            "shasum": "57951244b89eca6a38f617397fa90b9100400f7cc50c4b8f27b5f83e36edbc51",
            "type": "binary"
          }
        ]
      },
      {
        "relative_path": "embedded.mobileprovision",
        "size": 41978,
        "shasum": "a13323f7ac87b29849b13bc9028ed87259ee6eccfc76595b85f252ab59d29da6",
        "type": "binary"
      },
      {
        "relative_path": "logo.png",
        "size": 19037,
        "shasum": "d532376fcd38ca2d24f08e318225291588ad38c6b8def2127c8fab86b6577626",
        "type": "binary"
      }
    ]
  };

// Helper function to format file size
function formatSize(bytes) {
  if (bytes === 0) return '0 B';
  const k = 1024;
  const sizes = ['B', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// Update bundle information from Info.plist
function updateBundleInfo() {
  const totalSize = fileTree.size;
  document.getElementById('downloadSize').textContent = formatSize(totalSize);
  document.getElementById('installSize').textContent = formatSize(totalSize);  // Using same size for now

  // Find Info.plist in the tree
  function findInfoPlist(node) {
    if (node.relative_path === 'Info.plist') {
      return node;
    }
    if (node.children) {
      for (const child of node.children) {
        const result = findInfoPlist(child);
        if (result) return result;
      }
    }
    return null;
  }

  const infoPlist = findInfoPlist(fileTree);
  if (infoPlist) {
    // In a real implementation, we would parse the Info.plist file
    // For now, we'll just show some placeholder data
    document.getElementById('bundleId').textContent = 'com.example.hexacalc';
    document.getElementById('version').textContent = '1.0.0';
  }
}

// Helper function to flatten the tree
function flatten(node, parentLabel, labels, parents, values, types) {
  const name = node.relative_path.split('/').pop();
  const label = (parentLabel === null) ? "MyApp" : name;
  labels.push(label);
  parents.push(parentLabel === null ? "" : parentLabel);
  values.push(node.size);
  types.push(node.type);
  if (node.children) {
    for (const child of node.children) {
      flatten(child, label, labels, parents, values, types);
    }
  }
}

const labels = [], parents = [], values = [], types = [];
flatten(fileTree, null, labels, parents, values, types);

// Optional: assign color per type
const colorMap = {
  directory: "#b0b4ff",
  binary: "#a5d8ff",
  asset_catalog: "#ffe066",
  "": "#ddd"
};
const markerColors = types.map(type => colorMap[type] || "#ddd");

const data = [{
  type: "treemap",
  labels,
  parents,
  values,
  branchvalues: 'total',
  textinfo: 'label+value',
  outsidetextfont: { size: 14, color: "#888" },
  leaf: { opacity: 0.8 },
  marker: { colors: markerColors },
  maxdepth: 3,
  pathbar: {
    visible: true,
    textfont: {
      size: 12,
      color: "#000"
    },
    side: "top",
    thickness: 25
  }
}];

const layout = {
  margin: { l: 0, r: 0, b: 0, t: 32 },
  width: 900,
  height: 700,
  uniformtext: {
    minsize: 10
  }
};

const config = {
  displayModeBar: false,
  responsive: true
};

// Initialize the visualization
Plotly.newPlot('chart', data, layout, config);
updateBundleInfo();

// Add click handler for the chart
document.getElementById('chart').on('plotly_click', function(data) {
  const clickedLabel = data.points[0].label;
  console.log('Clicked label:', clickedLabel);
});
</script>
</body>
</html>
